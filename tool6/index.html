<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PBO Checklist</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#666769; color:#fff; }
    .dark-mode { background:#1A252C; color:#fff; }
    .card { background:#026503; padding:20px; margin:20px; border-radius:10px; }
    .dark-mode .card { background:#023804; }
    button { margin-top:10px; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
    .reset-btn { background:#f0f0f0; color:#000; }
    .dark-mode .reset-btn { background:#444; color:#fff; }
    .strike { text-decoration: line-through; opacity:0.6; }
    .loader { display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh; }
    .loader img { width:220px; height:220px; object-fit:cover; border-radius:50%; }
    #toggleMode { position:absolute; top:15px; right:15px; padding:6px 10px; border-radius:6px; background:#f0f0f0; color:#000; }
    .dark-mode #toggleMode { background:#444; color:#fff; }
  </style>
</head>
<body>
  <div id="loader" class="loader">
    <button id="toggleMode">ðŸŒ™ Dark Mode</button>
    <img src="https://i.imgur.com/XZcfQzw.png" alt="logo">
    <button id="loadBtn">Load Data</button>
    <p id="loadingText" style="display:none;">Loading...</p>
  </div>

  <div id="content" style="display:none;">
    <button id="toggleMode2">ðŸŒ™ Dark Mode</button>
    <h1>PBO Checklist</h1>
    <div id="daily" class="card">
      <h2>Daily</h2>
      <div id="dailyList"></div>
      <button class="reset-btn" onclick="resetChecks('Daily')">Reset Dailies</button>
    </div>
    <div id="weekly" class="card alt">
      <h2>Weekly</h2>
      <div id="weeklyList"></div>
      <button class="reset-btn" onclick="resetChecks('Weekly')">Reset Weeklies</button>
    </div>
    <div id="others" class="card">
      <h2>Others</h2>
      <div id="othersList"></div>
    </div>

    <!-- VS Seeker -->
    <div class="card alt">
      <h2>VS Seeker</h2>
      <label><input type="checkbox" id="vsSeekerCheck"> Activate VS Seeker</label>
      <div id="vsCountdown"></div>
      <div id="vsPopup" style="display:none; position:fixed; top:20%; left:50%; transform:translateX(-50%);
           background:#333; color:#fff; padding:20px; border-radius:10px; z-index:1000;">
        <p>VS Seeker is ready!</p>
        <button onclick="document.getElementById('vsPopup').style.display='none'">X</button>
      </div>
    </div>
  </div>

  <script>
    let dark=false;
    function toggleMode(){
      dark=!dark;
      document.body.classList.toggle("dark-mode",dark);
      const btns=document.querySelectorAll("#toggleMode,#toggleMode2");
      btns.forEach(b=>{
        b.textContent=dark?"â˜€ Light Mode":"ðŸŒ™ Dark Mode";
      });
    }
    document.getElementById("toggleMode").onclick=toggleMode;
    document.getElementById("toggleMode2").onclick=toggleMode;

    document.getElementById("loadBtn").onclick=()=>{
      document.getElementById("loadingText").style.display="block";
      fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vSnQAomUZRPHbub-G3CwuUY9iByOE8Q1KHhat_xUIx3bUSo2TfG3DEkET3dumTbSKUMzDlCr3qo0BeN/pub?output=csv")
        .then(r=>r.text()).then(csv=>{
          const rows=csv.split("\n").map(r=>r.split(","));
          const head=rows.shift();
          const act=head.indexOf("Activity");
          const loc=head.indexOf("Location");
          const con=head.indexOf("Content");
          const time=head.indexOf("Time");
          let daily="",weekly="",others="";
          rows.forEach((r,i)=>{
            if(r.length<4) return;
            const id="chk"+i;
            const group=r[time].trim();
            const item=`<label><input type="checkbox" id="${id}" onchange="markCheck('${id}')"> 
              ${r[act]} - ${r[loc]} - ${r[con]} (${r[time]})
              <span id="${id}ts"></span></label><br>`;
            if(group==="Daily") daily+=item;
            else if(group==="Weekly") weekly+=item;
            else others+=item+`<button class="reset-btn" onclick="resetSingle('${id}')">Reset</button><br>`;
          });
          document.getElementById("dailyList").innerHTML=daily;
          document.getElementById("weeklyList").innerHTML=weekly;
          document.getElementById("othersList").innerHTML=others;
          document.getElementById("loader").style.display="none";
          document.getElementById("content").style.display="block";
        });
    };

    function markCheck(id){
      const cb=document.getElementById(id);
      const ts=document.getElementById(id+"ts");
      if(cb.checked){
        cb.parentNode.classList.add("strike");
        ts.textContent=" ("+new Date().toLocaleString()+")";
      } else {
        cb.parentNode.classList.remove("strike");
      }
    }
    function resetChecks(type){
      document.querySelectorAll("#"+type.toLowerCase()+"List input[type=checkbox]").forEach(cb=>{
        cb.checked=false; cb.parentNode.classList.remove("strike");
      });
    }
    function resetSingle(id){
      const cb=document.getElementById(id);
      if(cb){ cb.checked=false; cb.parentNode.classList.remove("strike"); }
    }

    /* VS Seeker */
    let vsTimer, vsEnd, vsAudioCtx;
    function playBeep(){
      if(!vsAudioCtx) vsAudioCtx=new (window.AudioContext||window.webkitAudioContext)();
      const osc=vsAudioCtx.createOscillator();
      const gain=vsAudioCtx.createGain();
      osc.type="sine"; osc.frequency.setValueAtTime(880,vsAudioCtx.currentTime);
      gain.gain.setValueAtTime(0.2,vsAudioCtx.currentTime);
      osc.connect(gain); gain.connect(vsAudioCtx.destination);
      osc.start(); osc.stop(vsAudioCtx.currentTime+0.5);
    }
    document.getElementById("vsSeekerCheck").addEventListener("change",e=>{
      clearInterval(vsTimer); document.getElementById("vsCountdown").innerText="";
      if(e.target.checked){
        vsEnd=Date.now()+15*1000; // 15s test
        if(!vsAudioCtx){ // init context
          vsAudioCtx=new (window.AudioContext||window.webkitAudioContext)();
          const osc=vsAudioCtx.createOscillator();
          osc.connect(vsAudioCtx.destination); osc.start(); osc.stop(vsAudioCtx.currentTime);
        }
        vsTimer=setInterval(()=>{
          const remain=vsEnd-Date.now();
          if(remain<=0){
            clearInterval(vsTimer);
            playBeep();
            document.getElementById("vsPopup").style.display="block";
            document.getElementById("vsCountdown").innerText="";
          } else {
            const sec=Math.ceil(remain/1000);
            const m=Math.floor(sec/60), s=sec%60;
            document.getElementById("vsCountdown").innerText=m+"m "+(s<10?"0":"")+s+"s remaining";
          }
        },1000);
      }
    });
  </script>
</body>
</html>
