<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PBO Battle Tool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #666769;
      color: #F0F0F0;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      justify-content: flex-end;
      padding: 10px;
    }
    button {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
    }
    .section {
      margin: 20px;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .highlight {
      background-color: #02491D;
    }
    table {
      border-collapse: collapse;
      margin-top: 10px;
      width: 100%;
    }
    th, td {
      border: 1px solid #999;
      padding: 6px;
      text-align: left;
    }
    #loading-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
    }
    #app {
      display: none;
    }
    .dark-mode {
      background: #1A252C;
      color: #f1f1f1;
    }
    .dark-mode .section {
      border: 1px solid #555;
    }
    .dark-mode table {
      border: 1px solid #555;
      background: #1e1e1e;
    }
    .dark-mode th,
    .dark-mode td {
      border: 1px solid #555;
      color: #f1f1f1;
    }
    .dark-mode .highlight {
      background: #023804;
    }
    .dark-mode button {
      background: #333;
      color: #f1f1f1;
    }
    .dark-mode .load-button {
      background: #f0f0f0 !important;
      color: #000 !important;
    }
  </style>
</head>
<body>

<header>
  <button id="darkModeToggle">ðŸŒ™ Dark Mode</button>
</header>

<div id="loading-screen">
  <img src="https://i.imgur.com/XZcfQzw.png" style="max-width:200px; margin-bottom:20px;">
  <button id="loadDataBtn" class="load-button">Load Data</button>
  <p id="loadingText"></p>
</div>

<div id="app">

  <div class="section highlight">
    <h2>Mega Stone Check</h2>
    <select id="megaSelect">
      <option value="">Select Mega Stone</option>
    </select>
    <button id="megaSearchBtn">Search</button>
    <button id="megaResetBtn">Reset</button>
    <div id="megaResults"></div>
  </div>

  <div class="section">
    <h2>PvP Check</h2>
    <input type="text" id="pvpInput" placeholder="Enter PokÃ©mon name" />
    <button id="pvpSearchBtn">Search</button>
    <button id="pvpResetBtn">Reset</button>
    <div id="pvpResults"></div>
  </div>

</div>

<script>
  // Dark Mode
  const darkToggle = document.getElementById("darkModeToggle");
  darkToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");
    darkToggle.textContent = document.body.classList.contains("dark-mode")
      ? "â˜€ï¸ Light Mode" : "ðŸŒ™ Dark Mode";
  });

  // Loading
  const loadBtn = document.getElementById("loadDataBtn");
  const loadText = document.getElementById("loadingText");
  const loadingScreen = document.getElementById("loading-screen");
  const app = document.getElementById("app");

  loadBtn.addEventListener("click", async () => {
    loadBtn.disabled = true;
    loadText.textContent = "Loading...";
    await loadData();
    loadingScreen.style.display = "none";
    app.style.display = "block";
  });

  // Sheets
  const megaSheet = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT8oRNGXyajLEDTw_z2AYgO5ls7TD9khstdBS2RL6PD9CwB06GKGM9dl2SerCRtSjSf5Y-8lo4sZ7UP/pub?output=csv";
  const pvpSheet  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSp2K2rlJkpsFvuUWBjjiO-qpoJnfAx2vXJATqJYpK8fwmxuYBvKPihKvnPKChSt276QRjLkMlUTMgz/pub?output=csv";

  let megaData = [];
  let pvpData = [];

  async function fetchCSV(url) {
    const res = await fetch(url);
    const text = await res.text();
    return text.split("\n").map(r => r.split(",").map(c => c.trim()));
  }

  async function loadData() {
    const [mega, pvp] = await Promise.all([
      fetchCSV(megaSheet),
      fetchCSV(pvpSheet)
    ]);

    megaData = mega;
    pvpData = pvp;

    const megaSelect = document.getElementById("megaSelect");
    [...new Set(megaData.slice(1).map(r => r[0]))].forEach(stone => {
      const opt = document.createElement("option");
      opt.value = stone;
      opt.textContent = stone;
      megaSelect.appendChild(opt);
    });
  }

  function renderTable(headers, rows) {
    if (!rows.length) return "<p>No results found.</p>";
    let html = "<table><thead><tr>";
    headers.forEach(h => html += `<th>${h}</th>`);
    html += "</tr></thead><tbody>";
    rows.forEach(r => {
      html += "<tr>" + r.map(c => `<td>${c}</td>`).join("") + "</tr>";
    });
    html += "</tbody></table>";
    return html;
  }

  // Mega Stone Check
  document.getElementById("megaSearchBtn").addEventListener("click", () => {
    const stone = document.getElementById("megaSelect").value;
    const container = document.getElementById("megaResults");
    if (stone) {
      container.innerHTML = renderTable(
        megaData[0],
        megaData.slice(1).filter(r => r[0] === stone)
      );
    } else {
      container.innerHTML = "<p>Please select a mega stone.</p>";
    }
  });

  document.getElementById("megaResetBtn").addEventListener("click", () => {
    document.getElementById("megaSelect").value = "";
    document.getElementById("megaResults").innerHTML = "";
  });

  // PvP Check
  document.getElementById("pvpSearchBtn").addEventListener("click", () => {
    const query = document.getElementById("pvpInput").value.trim().toLowerCase();
    const rows = pvpData.slice(1).filter(r =>
      r[0] && r[0].toLowerCase().includes(query)
    );
    const container = document.getElementById("pvpResults");
    container.innerHTML = rows.length
      ? renderTable(pvpData[0], rows)
      : "<p>Currently not listed...</p>";
  });

  document.getElementById("pvpInput").addEventListener("keydown", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      document.getElementById("pvpSearchBtn").click();
    }
  });

  document.getElementById("pvpResetBtn").addEventListener("click", () => {
    document.getElementById("pvpInput").value = "";
    document.getElementById("pvpResults").innerHTML = "";
  });
</script>

</body>
</html>
