<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PBO Utility Tool 1</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#666769; color:#fff; }
    .dark-mode { background:#1A252C; color:#fff; }
    .card { background:#026503; padding:20px; margin:20px; border-radius:10px; }
    .dark-mode .card { background:#023804; }
    button { margin-top:10px; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
    .reset-btn { background:#f0f0f0; color:#000; }
    .dark-mode .reset-btn { background:#444; color:#fff; }
    .strike { text-decoration: line-through; opacity:0.6; }
    .loader { display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh; }
    .loader img { width:220px; height:220px; object-fit:cover; border-radius:50%; }

    #toggleMode {
      position: fixed;
      top: 15px;
      right: 15px;
      padding: 6px 10px;
      border-radius: 6px;
      background: #f0f0f0;
      color: #000;
      z-index: 1001;
    }
    .dark-mode #toggleMode {
      background: #444;
      color: #fff;
    }

    #content {
      display:none;
      position:relative;
      padding-top: 70px;
    }
  </style>
</head>
<body>
  <!-- Dark/Light toggle -->
  <button id="toggleMode">ðŸŒ™ Dark Mode</button>

  <div id="loader" class="loader">
    <img src="https://i.imgur.com/XZcfQzw.png" alt="logo">
    <button id="loadBtn">Load Data</button>
    <p id="loadingText" style="display:none;">Loading...</p>
  </div>

  <div id="content">
    <div id="mainCard" class="card">
      <h2>Utility Tool 1</h2>
      <label for="spawnRegion">Choose Region:</label>
      <select id="spawnRegion"></select>
      <div id="spawnResult"></div>
      <div id="chestResult"></div>
      <div id="megaResult"></div>
      <div id="pvpResult"></div>
    </div>
  </div>

  <script>
    let dark = false;
    function toggleMode(){
      dark = !dark;
      document.body.classList.toggle("dark-mode", dark);
      const btn = document.getElementById("toggleMode");
      btn.textContent = dark ? "â˜€ Light Mode" : "ðŸŒ™ Dark Mode";
    }
    document.getElementById("toggleMode").onclick = toggleMode;

    // --- Datenquellen ---
    const spawnSheets = {
      "Region A": "URL_TO_CSV_A",
      "Region B": "URL_TO_CSV_B",
      "Region C": "URL_TO_CSV_C",
      "Region D": "URL_TO_CSV_D",
      "Region E": "URL_TO_CSV_E",
      "Region F": "URL_TO_CSV_F"
    };
    const chestSheet = "URL_TO_CHEST_CSV";
    const megaSheet = "URL_TO_MEGA_CSV";
    const pvpSheet = "URL_TO_PVP_CSV";

    let spawnData = {};
    let chestData = [];
    let megaData = [];
    let pvpData = [];

    // --- Optimiert: fetchCSV + loadData ---
    async function fetchCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      return text.split("\n").map(r => r.split(",").map(c => c.trim()));
    }

    async function loadData() {
      const spawnPromises = Object.entries(spawnSheets).map(([region, url]) =>
        fetchCSV(url).then(data => [region, data])
      );

      const [spawnResults, chest, mega, pvp] = await Promise.all([
        Promise.all(spawnPromises),
        fetchCSV(chestSheet),
        fetchCSV(megaSheet),
        fetchCSV(pvpSheet)
      ]);

      spawnResults.forEach(([region, data]) => spawnData[region] = data);
      chestData = chest;
      megaData = mega;
      pvpData = pvp;

      // Dropdowns befÃ¼llen
      const select = document.getElementById("spawnRegion");
      select.innerHTML = "";
      Object.keys(spawnData).forEach(region => {
        const opt = document.createElement("option");
        opt.value = region;
        opt.textContent = region;
        select.appendChild(opt);
      });

      document.getElementById("loader").style.display = "none";
      document.getElementById("content").style.display = "block";
    }

    // --- Event Listener ---
    document.getElementById("loadBtn").onclick = () => {
      const loadBtn = document.getElementById("loadBtn");
      const loadingText = document.getElementById("loadingText");
      loadBtn.disabled = true;
      loadingText.style.display = "block";
      loadingText.textContent = "Loading...";
      loadData();
    };
  </script>
</body>
</html>
