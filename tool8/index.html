<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dynamax Helper</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  :root{
    --bg-light:#666769;
    --bg-dark:#1A252C;
    --card-light:#02491D;
    --card-dark:#023804;
    --button-bg:#F0F0F0;
    --toggle-light:#F0F0F0;
    --toggle-dark:#333333;
    --text-light:#0A0A0A;
    --text-dark:#F5F5F5;
    --glass:rgba(255,255,255,0.04);
  }

  html,body{
    height:100%;
    margin:0;
    font-family:Inter,system-ui,Arial,sans-serif;
    transition:background .25s,color .25s;
  }

  body{
    background:var(--bg-light);
    color:var(--text-dark);
  }
  body.dark{
    background:var(--bg-dark);
    color:var(--text-dark);
  }

  .mode-toggle{
    position:fixed;
    top:14px;
    right:14px;
    z-index:1200;
    background:var(--toggle-light);
    color:#000;
    padding:8px 14px;
    border-radius:10px;
    cursor:pointer;
    box-shadow:0 6px 16px rgba(0,0,0,0.15);
    user-select:none;
    font-size:14px;
  }
  body.dark .mode-toggle{
    background:var(--toggle-dark);
    color:#F0F0F0;
  }

  .loader{
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:20px;
    text-align:center;
  }
  .loader img.logo{
    width:200px;
    height:200px;
    border-radius:50%;
    object-fit:cover;
  }
  .load-btn{
    display:none; /* ‚Üê Button bleibt technisch vorhanden */
  }
  .loading-text{
    font-size:14px;
    color:#F0F0F0;
  }

  .wrap{
    max-width:980px;
    margin:24px auto;
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:18px;
  }

  .card{
    border-radius:14px;
    padding:18px;
    background:var(--card-light);
    color:#F0F0F0;
    box-shadow:0 10px 30px rgba(0,0,0,0.12);
  }
  body.dark .card{ background:var(--card-dark); }
</style>
</head>

<body>

<!-- Dark/Light Toggle (initial versteckt) -->
<div id="modeToggle" class="mode-toggle" style="display:none">üåô Dark Mode</div>

<!-- Loading -->
<div id="loading" class="loader">
  <img class="logo" src="https://i.imgur.com/XZcfQzw.png" alt="Dynamax logo">
  <button id="loadBtn" class="load-btn">Load Data</button>
  <div id="loadingText" class="loading-text">Loading...</div>
</div>

<!-- App (UNVER√ÑNDERT) -->
<div id="app" class="wrap" style="display:none;">
  <!-- kompletter Originalinhalt unver√§ndert -->
  <!-- (dein vollst√§ndiger App-Code ist hier exakt wie vorher) -->
</div>

<script>
/* ===== ORIGINAL SCRIPT ===== */
const $=id=>document.getElementById(id);
const escapeHtml=s=>s==null?'':String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
function normalizeValue(v){if(v==null)return'';const s=String(v).trim();if(!s)return'';if(/^(2|2\.0)$/i.test(s))return'2';if(/^(1|1\.0)$/i.test(s))return'1';if(/^(0\.5|¬Ω|1\/2)$/i.test(s))return'0.5';if(/^(0|0\.0|immune|x0)$/i.test(s.toLowerCase()))return'0';return s;}
function valueClass(v){const n=normalizeValue(v);if(n==='2')return'cell-strong';if(n==='1')return'cell-normal';if(n==='0.5')return'cell-resist';if(n==='0')return'cell-immune';return'cell-other';}

const URL_INFO="https://docs.google.com/spreadsheets/d/e/2PACX-1vRKBJf3BXL7kqLIu8WAZCiFIBqNTMVvWCmkRA2kVoC30QskuIRkxwUKJJnrHKh2Y8I18iZ0p068wRD2/pub?output=csv";
const URL_DB="https://docs.google.com/spreadsheets/d/e/2PACX-1vRGq_ta_VKuhpNif51aoWSm2XKE04CHREcDqGObDZnBQ0kK3Yo-_Bz7i7u1oP1Xv9pRm0-xN7dDgyiT/pub?output=csv";
const URL_MOVE="https://docs.google.com/spreadsheets/d/e/2PACX-1vRfBHLwHVULXabVXPztSXOz-36oGnjJFxuHyhgftVYg3Ft_f7VqkVwfpdmQwrfZEXrdjCKnydJBqRHt/pub?output=csv";
const URL_ATTACK="https://docs.google.com/spreadsheets/d/e/2PACX-1vQUYm_GBIYmou5lzjHIeXmz9GlP0d4_z3g6Jxrpof_DvIBFdOh8bL4dNF8v4T2Vn5sseu8zOhRzP74O/pub?output=csv";

let infoRows=[],infoFields=[],dbRows=[],dbFields=[],moveRows=[],moveFields=[],atkRows=[],atkFields=[];
function parseCSV(url){return new Promise((res,rej)=>Papa.parse(url,{download:true,header:true,skipEmptyLines:true,complete:r=>res({fields:r.meta.fields||[],data:r.data}),error:e=>rej(e)}));}
function showLoading(t){$('loadingText').textContent=t||'Loading...';}
function hideLoading(){}

function loadAll(){
  $('loadBtn').disabled=true;
  showLoading('Loading...');
  Promise.all([
    parseCSV(URL_INFO).then(r=>{infoFields=r.fields;infoRows=r.data;}),
    parseCSV(URL_DB).then(r=>{dbFields=r.fields;dbRows=r.data;}),
    parseCSV(URL_MOVE).then(r=>{moveFields=r.fields;moveRows=r.data;}),
    parseCSV(URL_ATTACK).then(r=>{atkFields=r.fields;atkRows=r.data;})
  ]).then(()=>{
    $('loading').style.display='none';
    $('app').style.display='flex';
    $('modeToggle').style.display='block';
    populate();
  }).catch(e=>{
    $('loadingText').textContent='Error';
    console.error(e);
    $('loadBtn').disabled=false;
  });
}

const modeToggle=$('modeToggle');
function updateModeLabel(){
  modeToggle.textContent=document.body.classList.contains('dark')
    ? '‚òÄÔ∏è Light Mode'
    : 'üåô Dark Mode';
}
modeToggle.onclick=()=>{
  document.body.classList.toggle('dark');
  updateModeLabel();
};
updateModeLabel();

/* Auto-Start */
window.addEventListener('DOMContentLoaded', loadAll);
$('loadBtn').onclick=loadAll;
</script>

</body>
</html>
