<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dynamax Helper</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
:root{
  --bg-light:#666769;
  --bg-dark:#1A252C;
  --card-light:#02491D;
  --card-dark:#023804;
  --button-bg:#F0F0F0;
  --toggle-light:#F0F0F0;
  --toggle-dark:#333333;
  --text-dark:#F5F5F5;
  --glass:rgba(255,255,255,0.04);
}
html,body{
  height:100%;
  margin:0;
  font-family:Inter,system-ui,Arial,sans-serif;
}
body{background:var(--bg-light);color:var(--text-dark)}
body.dark{background:var(--bg-dark)}

.mode-toggle{
  position:fixed;top:14px;right:14px;z-index:1200;
  background:var(--toggle-light);color:#000;
  padding:8px 14px;border-radius:10px;
  cursor:pointer;font-size:14px;
}
body.dark .mode-toggle{background:var(--toggle-dark);color:#F0F0F0}

/* loading */
.loader{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:20px;
}
.loader img.logo{
  width:200px;height:200px;
  border-radius:50%;
  object-fit:cover;
}
.loading-text{font-size:14px;color:#F0F0F0}

/* layout */
.wrap{
  max-width:980px;
  margin:24px auto;
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:18px;
}
.card{
  border-radius:14px;
  padding:18px;
  background:var(--card-light);
  color:#F0F0F0;
}
body.dark .card{background:var(--card-dark)}

label{display:block;margin:10px 0 6px;font-weight:600}
select{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  background:#F0F0F0;
  color:#000;
}
body.dark select{background:#000;color:#F0F0F0}

.controls{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
.controls button{
  padding:10px 14px;
  border-radius:8px;
  border:none;
  background:var(--button-bg);
  cursor:pointer;
}

.results{
  margin-top:12px;
  padding:12px;
  border-radius:10px;
  background:var(--glass);
}
pre{white-space:pre-wrap;margin:0}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)}
.badge{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.15);margin:4px}
.badge.highlight{background:#ff4444;font-weight:700}
</style>
</head>

<body>

<div id="modeToggle" class="mode-toggle" style="display:none">üåô Dark Mode</div>

<!-- Loading -->
<div id="loading" class="loader">
  <img class="logo" src="https://i.imgur.com/XZcfQzw.png">
  <div id="loadingText" class="loading-text">Loading...</div>
</div>

<!-- App -->
<div id="app" class="wrap" style="display:none">

  <div class="card">
    <h2>Dynamax Info</h2>
    <select id="infoFilter"></select>
    <div class="controls">
      <button id="infoShow">Show</button>
      <button id="infoReset">Reset</button>
    </div>
    <div id="infoOut" class="results" style="display:none"></div>
  </div>

  <div class="card">
    <h2>Dynamax Database</h2>
    <select id="dbFilter"></select>
    <div class="controls">
      <button id="dbShow">Show</button>
      <button id="dbReset">Reset</button>
    </div>
    <div id="dbOut" class="results" style="display:none"></div>
  </div>

</div>

<script>
const $=id=>document.getElementById(id);
const escapeHtml=s=>String(s||'').replace(/[&<>]/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;" }[m]));

const URL_INFO="https://docs.google.com/spreadsheets/d/e/2PACX-1vRKBJf3BXL7kqLIu8WAZCiFIBqNTMVvWCmkRA2kVoC30QskuIRkxwUKJJnrHKh2Y8I18iZ0p068wRD2/pub?output=csv";
const URL_DB="https://docs.google.com/spreadsheets/d/e/2PACX-1vRGq_ta_VKuhpNif51aoWSm2XKE04CHREcDqGObDZnBQ0kK3Yo-_Bz7i7u1oP1Xv9pRm0-xN7dDgyiT/pub?output=csv";

let infoRows=[],infoFields=[],dbRows=[],dbFields=[];

function parseCSV(url){
  return new Promise(res=>{
    Papa.parse(url,{
      download:true,header:true,skipEmptyLines:true,
      complete:r=>res(r)
    });
  });
}

function populate(){
  infoFilter.innerHTML='<option value="">-- select --</option>';
  [...new Set(infoRows.map(r=>r[infoFields[0]]).filter(Boolean))]
    .forEach(v=>infoFilter.add(new Option(v,v)));

  dbFilter.innerHTML='<option value="">-- select --</option>';
  [...new Set(dbRows.map(r=>r[dbFields[0]]).filter(Boolean))]
    .forEach(v=>dbFilter.add(new Option(v,v)));
}

async function loadAll(){
  const info=await parseCSV(URL_INFO);
  infoRows=info.data; infoFields=info.meta.fields;

  const db=await parseCSV(URL_DB);
  dbRows=db.data; dbFields=db.meta.fields;

  populate();
  loading.style.display='none';
  app.style.display='flex';
  modeToggle.style.display='block';
}

infoShow.onclick=()=>{
  const v=infoFilter.value;
  if(!v)return;
  infoOut.innerHTML=infoRows
    .filter(r=>r[infoFields[0]]===v)
    .map(r=>`<pre>${escapeHtml(r[infoFields[1]])}</pre>`).join('');
  infoOut.style.display='block';
};

infoReset.onclick=()=>{infoFilter.selectedIndex=0;infoOut.style.display='none';};

dbShow.onclick=()=>{
  const v=dbFilter.value;
  if(!v)return;
  const rows=dbRows.filter(r=>r[dbFields[0]]===v);
  let h='<table><tr>';
  dbFields.slice(1,6).forEach(f=>h+=`<th>${f}</th>`);
  h+='</tr>';
  rows.forEach(r=>{
    h+='<tr>';
    dbFields.slice(1,6).forEach(f=>h+=`<td>${escapeHtml(r[f])}</td>`);
    h+='</tr>';
  });
  dbOut.innerHTML=h+'</table>';
  dbOut.style.display='block';
};

dbReset.onclick=()=>{dbFilter.selectedIndex=0;dbOut.style.display='none';};

modeToggle.onclick=()=>{
  document.body.classList.toggle('dark');
  modeToggle.textContent=document.body.classList.contains('dark')
    ? '‚òÄÔ∏è Light Mode'
    : 'üåô Dark Mode';
};

/* AUTO LOAD */
window.addEventListener('DOMContentLoaded', loadAll);
</script>
</body>
</html>
