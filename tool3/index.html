<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FAQ Tool</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{
  font-family:Arial, sans-serif;
  background:#666769;
  color:#f0f0f0;
  margin:0;
}
header{
  padding:10px;
  text-align:right;
}
button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.card{
  background:#02491D;
  border-radius:10px;
  padding:15px;
  margin:20px;
}
select{
  padding:6px;
  margin:5px 0;
  width:100%;
}
.results{
  margin-top:10px;
}
pre.expl{
  background:#1A252C;
  padding:10px;
  border-radius:6px;
  white-space:pre-wrap;
}
#loading{
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
#app{ display:none; }

.dark body{ background:#1A252C; }
.dark .card{ background:#023804; }
</style>
</head>

<body>

<header>
  <button id="darkBtn">ðŸŒ™ Dark</button>
</header>

<div id="loading">
  <h2>FAQ Tool</h2>
  <button id="loadBtn">Load Data</button>
  <p id="loadingText" style="display:none">Loading...</p>
</div>

<div id="app">

  <!-- FAQ -->
  <div class="card">
    <h2>FAQ</h2>
    <label>Choose Type</label>
    <select id="typeSel"></select>

    <label>Choose Subtype</label>
    <select id="subSel" disabled></select>

    <button id="showFaq">Show</button>
    <div id="faqOut" class="results"></div>
  </div>

  <!-- Regi Trio -->
  <div class="card">
    <h2>Regi Trio Check</h2>
    <label>Choose Time</label>
    <select id="regiTime"></select>
    <button id="regiShow">Show</button>
    <div id="regiOut" class="results"></div>
  </div>

  <!-- Shoal Cave -->
  <div class="card">
    <h2>Shoal Cave Check</h2>
    <button id="shoalBtn">Check Tide</button>
    <div id="shoalOut" class="results"></div>
  </div>

</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

/* ---------- helpers ---------- */
const $=id=>document.getElementById(id);
const esc=s=>String(s||"").replace(/[&<>]/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;" }[m]));

/* ---------- dark ---------- */
$("darkBtn").onclick=()=>{
  document.body.classList.toggle("dark");
  $("darkBtn").textContent=document.body.classList.contains("dark")?"â˜€ï¸ Light":"ðŸŒ™ Dark";
};

/* ---------- sheets ---------- */
const FAQ_CSV  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSfISqMJoPKSFFO4tRUY1V_L7J5C02XG7xbs_T0y7dcWdPjvAKX4064cVGHGgYJ7PFkiOHoy74j7KyU/pub?output=csv";
const REGI_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSnZTHT3SeW7VWywFDBWhvjor0NqrwEcXPyBPOH53FD_Z5GHPNhO4NlGfpzniRjpuJBHna8vZJ1Ndia/pub?output=csv";

let faqRows=[], faqFields=[];
let regiRows=[], regiFields=[];

/* ---------- load ---------- */
$("loadBtn").onclick=async()=>{
  $("loadBtn").disabled=true;
  $("loadingText").style.display="block";

  const loadCSV=url=>new Promise(res=>{
    Papa.parse(url,{
      download:true,
      header:true,
      skipEmptyLines:true,
      complete:r=>res({
        rows:r.data,
        fields:r.meta.fields
      })
    });
  });

  const [faq,regi]=await Promise.all([loadCSV(FAQ_CSV),loadCSV(REGI_CSV)]);
  faqRows=faq.rows; faqFields=faq.fields;
  regiRows=regi.rows; regiFields=regi.fields;

  initFAQ();
  initRegi();

  $("loading").style.display="none";
  $("app").style.display="block";
};

/* ---------- FAQ ---------- */
const keyType=()=>faqFields[0];
const keySub =()=>faqFields[1];
const keyTxt =()=>faqFields[2];

function initFAQ(){
  const tSel=$("typeSel");
  tSel.innerHTML='<option value="">-- choose --</option>';
  [...new Set(faqRows.map(r=>r[keyType()]))]
    .filter(Boolean)
    .forEach(v=>tSel.appendChild(new Option(v,v)));
}

$("typeSel").onchange=()=>{
  const v=$("typeSel").value;
  const sSel=$("subSel");
  sSel.innerHTML='<option value="">-- choose --</option>';
  if(!v){ sSel.disabled=true; return; }

  [...new Set(faqRows.filter(r=>r[keyType()]===v).map(r=>r[keySub()]))]
    .filter(Boolean)
    .forEach(x=>sSel.appendChild(new Option(x,x)));
  sSel.disabled=false;
};

$("showFaq").onclick=()=>{
  const t=$("typeSel").value, s=$("subSel").value;
  const m=faqRows.filter(r=>r[keyType()]===t && r[keySub()]===s);
  $("faqOut").innerHTML=m.length
    ? m.map(r=>`<pre class="expl">${esc(r[keyTxt()])}</pre>`).join("")
    : "No results.";
};

/* ---------- Regi ---------- */
function initRegi(){
  const sel=$("regiTime");
  sel.innerHTML='<option value="">-- choose --</option>';
  [...new Set(regiRows.map(r=>r[regiFields[0]]))]
    .filter(Boolean)
    .forEach(v=>sel.appendChild(new Option(v,v)));
}

$("regiShow").onclick=()=>{
  const t=$("regiTime").value;
  if(!t) return;
  const rows=regiRows.filter(r=>r[regiFields[0]]===t);
  $("regiOut").innerHTML=rows.length
    ? `<table>${rows.map(r=>`<tr><td>${esc(r[regiFields[1]])}</td><td>${esc(r[regiFields[2]])}</td></tr>`).join("")}</table>`
    : "No results.";
};

/* ---------- Shoal ---------- */
$("shoalBtn").onclick=()=>{
  const now=new Date();
  const m=now.getUTCHours()*60+now.getUTCMinutes();
  const low=[[0,180],[360,540],[720,900],[1080,1260]].some(([a,b])=>m>=a&&m<b);
  $("shoalOut").innerHTML=`UTC ${now.toISOString().slice(11,16)} â€” <b>${low?"Low Tide":"High Tide"}</b>`;
};

});
</script>

</body>
</html>
