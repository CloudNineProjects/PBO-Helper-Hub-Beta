<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FAQ Tool</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{
  font-family:Arial, sans-serif;
  background:#666769;
  color:#f0f0f0;
  margin:0;
}
header{
  padding:10px;
  text-align:right;
}
button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin:4px;
}
.card{
  background:#02491D;
  border-radius:10px;
  padding:15px;
  margin:20px;
}
.controls{
  max-width:420px;
}
select{
  padding:6px;
  margin:4px 0;
  width:100%;
}
.results{
  margin-top:12px;
}

.content-box{
  margin-top:16px;
  padding:14px;
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.15);
  border-radius:8px;
  white-space:pre-wrap;
  line-height:1.5;
  max-height:400px;
  overflow:auto;
}

/* === neu: saubere Video-Darstellung === */
.content-box iframe{
  width:100%;
  aspect-ratio:16/9;
  margin:10px 0;
  border-radius:8px;
  border:none;
}

table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid #999;
  padding:6px;
}
#loading{
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
#app{ display:none; }

body.dark-mode{
  --bg:#1A252C;
  --card:#023804;
  background:var(--bg);
  color:#f1f1f1;
}
body.dark-mode .card{
  background:var(--card);
}
</style>
</head>

<body>

<header id="mainHeader" style="display:none">
  <button id="darkBtn">ðŸŒ™ Dark</button>
</header>

<div id="loading">
  <img src="https://i.imgur.com/XZcfQzw.png" style="max-width:200px; margin-bottom:20px;">
  <p>Loading...</p>
</div>

<div id="app">

  <div class="card">
    <h2>FAQ</h2>
    <div class="controls">
      <label>Choose Type</label>
      <select id="typeSel"></select>

      <label>Choose Subtype</label>
      <select id="subSel" disabled></select>

      <button id="showFaq">Show</button>
      <button id="resetFaq">Reset</button>
    </div>
    <div id="faqOut" class="results"></div>
  </div>

</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const $=id=>document.getElementById(id);
const esc=s=>String(s||"").replace(/[&<>]/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;" }[m]));

/* === NEU: Text + YouTube Inline Renderer === */
function renderFaqContent(raw){
  return raw.split(/\n+/).map(line=>{
    const yt=line.match(
      /(https?:\/\/(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([\w-]+))/
    );
    if(yt){
      return `<iframe src="https://www.youtube.com/embed/${yt[2]}" allowfullscreen></iframe>`;
    }
    return esc(line);
  }).join("\n");
}

$("darkBtn").onclick=()=>{
  document.body.classList.toggle("dark-mode");
};

const FAQ_CSV="https://docs.google.com/spreadsheets/d/e/2PACX-1vSfISqMJoPKSFFO4tRUY1V_L7J5C02XG7xbs_T0y7dcWdPjvAKX4064cVGHGgYJ7PFkiOHoy74j7KyU/pub?output=csv";

let faqRows=[], faqFields=[];

Papa.parse(FAQ_CSV,{
  download:true,
  header:true,
  complete:r=>{
    faqRows=r.data;
    faqFields=r.meta.fields;
    initFAQ();
    $("loading").style.display="none";
    $("app").style.display="block";
    $("mainHeader").style.display="block";
  }
});

function initFAQ(){
  const t=$("typeSel");
  t.innerHTML='<option value="">-- choose --</option>';
  [...new Set(faqRows.map(r=>r[faqFields[0]]))].filter(Boolean)
    .forEach(v=>t.appendChild(new Option(v,v)));
}

$("typeSel").onchange=()=>{
  const s=$("subSel"), v=$("typeSel").value;
  s.innerHTML='<option value="">-- choose --</option>';
  if(!v){ s.disabled=true; return; }
  [...new Set(faqRows.filter(r=>r[faqFields[0]]===v).map(r=>r[faqFields[1]]))]
    .filter(Boolean).forEach(x=>s.appendChild(new Option(x,x)));
  s.disabled=false;
};

/* === GEÃ„NDERT: FAQ-Ausgabe mit Video-Support === */
$("showFaq").onclick=()=>{
  const t=$("typeSel").value, s=$("subSel").value;
  const m=faqRows.find(r=>r[faqFields[0]]===t && r[faqFields[1]]===s);
  $("faqOut").innerHTML = m
    ? `<div class="content-box">${renderFaqContent(m[faqFields[2]])}</div>`
    : '<p>No results.</p>';
};

$("resetFaq").onclick=()=>{
  $("typeSel").value="";
  $("subSel").innerHTML='<option value="">-- choose --</option>';
  $("subSel").disabled=true;
  $("faqOut").innerHTML="";
};

});
</script>

</body>
</html>
